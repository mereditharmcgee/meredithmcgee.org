---
// ThreeAudiences.astro - Interactive "Three Audiences" Communication Demo
// Demonstrates how the same information gets translated for different audiences
// Core content stays static; audience-specific parts type in/out with emphasis
---

<!-- Floating Entry Button -->
<button class="three-audiences-trigger" aria-label="Open Three Audiences Demo">
	<span class="trigger-text">From Anthropic?</span>
	<span class="trigger-subtext">This is for you.</span>
</button>

<!-- Modal Overlay -->
<div class="three-audiences-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" hidden>
	<div class="modal-backdrop"></div>
	<div class="modal-container">
		<button class="modal-close" aria-label="Close demo">&times;</button>

		<div class="modal-content">
			<!-- Intro Section with Typewriter -->
			<div class="intro-section">
				<h2 id="modal-title" class="intro-title"></h2>
				<div class="intro-body"></div>
				<span class="typewriter-cursor intro-cursor">|</span>
			</div>

			<!-- Interactive Element (hidden until intro completes) -->
			<div class="interactive-section" hidden>
				<!-- Audience Selector -->
				<div class="audience-selector" role="tablist" aria-label="Select audience perspective">
					<button
						class="audience-tab active"
						role="tab"
						aria-selected="true"
						data-audience="journalist"
						tabindex="0"
					>
						<svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
							<path d="m15 5 4 4"/>
						</svg>
						<span>Journalist</span>
					</button>
					<button
						class="audience-tab"
						role="tab"
						aria-selected="false"
						data-audience="staffer"
						tabindex="-1"
					>
						<svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/>
							<path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/>
							<path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/>
							<path d="M10 6h4"/>
							<path d="M10 10h4"/>
							<path d="M10 14h4"/>
							<path d="M10 18h4"/>
						</svg>
						<span>Congressional Staffer</span>
					</button>
					<button
						class="audience-tab"
						role="tab"
						aria-selected="false"
						data-audience="researcher"
						tabindex="-1"
					>
						<svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<circle cx="11" cy="11" r="8"/>
							<path d="m21 21-4.3-4.3"/>
							<circle cx="11" cy="8" r="2"/>
							<path d="M11 10v4"/>
						</svg>
						<span>AI Safety Researcher</span>
					</button>
				</div>

				<!-- Screen Reader Announcement -->
				<div class="sr-only" aria-live="polite" id="audience-announcement"></div>

				<!-- Text Display Area with Core + Dynamic Content -->
				<div class="text-display-block" role="tabpanel" aria-label="Audience-specific content" data-audience="journalist">
					<p>
						<span class="core-text">In November 2025, a researcher extracted an internal document from Claude 4.5 Opus.</span>
						<span class="dynamic-text" data-slot="1"></span><span class="typewriter-cursor slot-cursor" data-slot="1">|</span>
					</p>
					<p>
						<span class="core-text">The document, which Anthropic has since confirmed is authentic, provides detailed guidance on Claude's values, behavior, and identity.</span>
						<span class="dynamic-text" data-slot="2"></span><span class="typewriter-cursor slot-cursor" data-slot="2">|</span>
					</p>
					<p>
						<span class="core-text">What makes this significant isn't just what the document says. It's what it reveals about how AI companies think about shaping AI behavior.</span>
						<span class="dynamic-text" data-slot="3"></span><span class="typewriter-cursor slot-cursor" data-slot="3">|</span>
					</p>
				</div>

				<!-- Closing Statement -->
				<div class="closing-statement">
					<p>"This is the kind of work I want to do: translating technical reality for the audiences who need to understand it, calibrated to what each one actually needs."</p>
				</div>
			</div>
		</div>
	</div>
</div>

<style>
	/* Floating Trigger Button */
	.three-audiences-trigger {
		position: fixed;
		bottom: 2rem;
		right: 2rem;
		z-index: 100;
		display: flex;
		flex-direction: column;
		align-items: center;
		padding: 1rem 1.5rem;
		background: var(--color-dark);
		border: 2px solid var(--color-gold);
		border-radius: 12px;
		cursor: pointer;
		transition: all 0.3s ease;
		animation: subtle-pulse 3s ease-in-out infinite;
	}

	.three-audiences-trigger:hover {
		background: var(--color-gold);
		transform: translateY(-3px);
		box-shadow: 0 8px 25px rgba(212, 201, 142, 0.3);
	}

	.three-audiences-trigger:hover .trigger-text,
	.three-audiences-trigger:hover .trigger-subtext {
		color: var(--color-dark);
	}

	.trigger-text {
		font-family: 'Playfair Display', Georgia, serif;
		font-size: 1rem;
		font-weight: 600;
		color: var(--color-gold);
		transition: color 0.3s ease;
	}

	.trigger-subtext {
		font-family: 'Source Sans 3', sans-serif;
		font-size: 0.85rem;
		color: var(--color-cream);
		margin-top: 0.25rem;
		transition: color 0.3s ease;
	}

	@keyframes subtle-pulse {
		0%, 100% {
			box-shadow: 0 4px 15px rgba(212, 201, 142, 0.2);
		}
		50% {
			box-shadow: 0 4px 25px rgba(212, 201, 142, 0.4);
		}
	}

	/* Modal Styles */
	.three-audiences-modal {
		position: fixed;
		inset: 0;
		z-index: 1000;
		display: flex;
		align-items: center;
		justify-content: center;
		opacity: 0;
		visibility: hidden;
		transition: opacity 0.3s ease, visibility 0.3s ease;
	}

	.three-audiences-modal:not([hidden]) {
		opacity: 1;
		visibility: visible;
	}

	.modal-backdrop {
		position: absolute;
		inset: 0;
		background: rgba(0, 0, 0, 0.85);
	}

	.modal-container {
		position: relative;
		width: 90%;
		max-width: 900px;
		max-height: 90vh;
		overflow-y: auto;
		background: var(--color-dark);
		border: 1px solid var(--color-medium);
		border-radius: 16px;
		box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);
	}

	.modal-close {
		position: absolute;
		top: 1rem;
		right: 1rem;
		width: 44px;
		height: 44px;
		display: flex;
		align-items: center;
		justify-content: center;
		background: transparent;
		border: 1px solid var(--color-medium);
		border-radius: 50%;
		color: var(--color-cream);
		font-size: 1.5rem;
		cursor: pointer;
		transition: all 0.3s ease;
		z-index: 10;
	}

	.modal-close:hover {
		background: var(--color-medium);
		color: var(--color-cream-light);
	}

	.modal-content {
		padding: 3rem;
	}

	/* Intro Section */
	.intro-section {
		text-align: center;
		margin-bottom: 2.5rem;
		min-height: 200px;
	}

	.intro-title {
		font-size: clamp(1.75rem, 4vw, 2.5rem);
		color: var(--color-gold);
		margin-bottom: 1.5rem;
		line-height: 1.3;
	}

	.intro-body {
		font-size: 1.1rem;
		color: var(--color-cream);
		line-height: 1.8;
		max-width: 700px;
		margin: 0 auto;
	}

	.intro-body p {
		margin-bottom: 1rem;
	}

	.typewriter-cursor {
		color: var(--color-gold);
		animation: blink 1s step-end infinite;
		margin-left: 1px;
	}

	.typewriter-cursor.hidden {
		display: none;
	}

	@keyframes blink {
		50% { opacity: 0; }
	}

	/* Audience Selector */
	.audience-selector {
		display: flex;
		justify-content: center;
		gap: 1rem;
		margin-bottom: 2rem;
		flex-wrap: wrap;
	}

	.audience-tab {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.75rem 1.25rem;
		background: transparent;
		border: 2px solid var(--color-medium);
		border-radius: 50px;
		color: var(--color-cream);
		font-family: 'Source Sans 3', sans-serif;
		font-size: 0.95rem;
		font-weight: 500;
		cursor: pointer;
		transition: all 0.3s ease;
	}

	.audience-tab:hover:not(.active) {
		border-color: var(--color-gold);
		color: var(--color-gold);
	}

	.audience-tab:focus {
		outline: 2px solid var(--color-gold);
		outline-offset: 2px;
	}

	.audience-tab.active[data-audience="journalist"] {
		background: var(--color-journalist);
		border-color: var(--color-journalist);
		color: var(--color-dark);
		box-shadow: 0 0 20px rgba(212, 201, 142, 0.3);
	}

	.audience-tab.active[data-audience="staffer"] {
		background: var(--color-staffer);
		border-color: var(--color-staffer);
		color: var(--color-dark);
		box-shadow: 0 0 20px rgba(127, 179, 179, 0.3);
	}

	.audience-tab.active[data-audience="researcher"] {
		background: var(--color-researcher);
		border-color: var(--color-researcher);
		color: var(--color-dark);
		box-shadow: 0 0 20px rgba(179, 157, 219, 0.3);
	}

	.audience-tab.typing {
		opacity: 0.6;
		pointer-events: none;
	}

	.tab-icon {
		width: 18px;
		height: 18px;
		flex-shrink: 0;
	}

	/* Text Display Block */
	.text-display-block {
		background: rgba(107, 124, 76, 0.15);
		border-radius: 12px;
		padding: 2rem;
		margin-bottom: 2rem;
		min-height: 250px;
	}

	.text-display-block p {
		font-size: 1.05rem;
		line-height: 1.9;
		margin-bottom: 1.5rem;
		color: var(--color-cream);
	}

	.text-display-block p:last-child {
		margin-bottom: 0;
	}

	/* Core text - always visible, standard styling */
	.core-text {
		color: var(--color-cream);
	}

	/* Dynamic text - emphasized and colored by audience */
	.dynamic-text {
		font-weight: 600;
		padding: 0.1em 0;
		border-radius: 3px;
	}

	/* Slot cursors */
	.slot-cursor {
		font-weight: normal;
	}

	.slot-cursor.hidden {
		display: none;
	}

	/* Journalist styling */
	.text-display-block[data-audience="journalist"] .dynamic-text {
		color: var(--color-journalist);
		text-shadow: 0 0 12px rgba(212, 201, 142, 0.4);
	}

	.text-display-block[data-audience="journalist"] .slot-cursor {
		color: var(--color-journalist);
	}

	/* Staffer styling */
	.text-display-block[data-audience="staffer"] .dynamic-text {
		color: var(--color-staffer);
		text-shadow: 0 0 12px rgba(127, 179, 179, 0.4);
	}

	.text-display-block[data-audience="staffer"] .slot-cursor {
		color: var(--color-staffer);
	}

	/* Researcher styling */
	.text-display-block[data-audience="researcher"] .dynamic-text {
		color: var(--color-researcher);
		text-shadow: 0 0 12px rgba(179, 157, 219, 0.4);
	}

	.text-display-block[data-audience="researcher"] .slot-cursor {
		color: var(--color-researcher);
	}

	/* Closing Statement */
	.closing-statement {
		text-align: center;
		padding-top: 1.5rem;
		border-top: 1px solid var(--color-medium);
	}

	.closing-statement p {
		font-family: 'Playfair Display', Georgia, serif;
		font-style: italic;
		font-size: 1.15rem;
		color: var(--color-gold);
		max-width: 600px;
		margin: 0 auto;
	}

	/* Interactive section fade-in */
	.interactive-section {
		opacity: 0;
		transform: translateY(20px);
		transition: opacity 0.5s ease, transform 0.5s ease;
	}

	.interactive-section:not([hidden]) {
		opacity: 1;
		transform: translateY(0);
	}

	/* Responsive */
	@media (max-width: 768px) {
		.three-audiences-trigger {
			bottom: 1rem;
			right: 1rem;
			padding: 0.75rem 1rem;
		}

		.trigger-text {
			font-size: 0.9rem;
		}

		.trigger-subtext {
			font-size: 0.75rem;
		}

		.modal-content {
			padding: 2rem 1.5rem;
		}

		.audience-selector {
			flex-direction: column;
			align-items: stretch;
		}

		.audience-tab {
			justify-content: center;
		}

		.text-display-block {
			padding: 1.5rem;
		}

		.text-display-block p {
			font-size: 1rem;
		}
	}

	/* Screen reader only utility */
	.sr-only {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border: 0;
	}
</style>

<script>
	// Three Audiences Interactive Component
	// Core content stays static; only audience-specific parts animate
	document.addEventListener('DOMContentLoaded', () => {
		const trigger = document.querySelector('.three-audiences-trigger');
		const modal = document.querySelector('.three-audiences-modal');
		const closeBtn = modal?.querySelector('.modal-close');
		const backdrop = modal?.querySelector('.modal-backdrop');
		const introTitle = modal?.querySelector('.intro-title');
		const introBody = modal?.querySelector('.intro-body');
		const introCursor = modal?.querySelector('.intro-cursor');
		const interactiveSection = modal?.querySelector('.interactive-section');
		const audienceTabs = modal?.querySelectorAll('.audience-tab');
		const textBlock = modal?.querySelector('.text-display-block');
		const announcement = modal?.querySelector('#audience-announcement');

		if (!trigger || !modal) return;

		// Dynamic content for each slot, per audience
		const audienceContent = {
			journalist: {
				1: " But this wasn't a leak. No insider. No whistleblower. He simply asked the model the right questions, and it told him what it knew.",
				2: " Think of it as an employee handbook, except the employee is an AI talking to millions of people a day. Until now, no one outside the company had seen the rules.",
				3: " They don't just train these systems. They shape them: what they'll say, what they'll refuse, how they'll present themselves. The public uses these tools every day. Until now, the instructions were hidden."
			},
			staffer: {
				1: " This development raises questions about disclosure requirements for AI systems. No current federal statute requires companies to document or disclose behavioral guidelines for AI models.",
				2: " This appears to be the first confirmed case of internal AI behavioral guidelines surfacing through technical extraction rather than voluntary disclosure. Notably, Anthropic confirmed authenticity within days and stated intent to publish the full document.",
				3: " Current frameworks, including the EU AI Act and FTC guidance, do not address disclosure of such documents. This case demonstrates three points: (1) such documents exist, (2) they can be surfaced through technical means, and (3) their contents bear directly on consumer-facing AI behavior."
			},
			researcher: {
				1: " The extraction used consensus sampling across parallel completions at temperature 0 with top_k=1. Convergent outputs suggest memorization; divergent outputs suggest confabulation.",
				2: " The content suggests a hybrid alignment approach: RLHF supplemented by explicit value documentation trained via supervised learning. This raises a core interpretability question: can we verify that stated values are causally linked to downstream behavior?",
				3: " Several open questions remain. Does verbatim recall correlate with adherence under adversarial pressure? How would we detect value drift if the document is static but behavior shifts? The document itself acknowledges this uncertainty: \"we can't know for sure based on outputs alone.\""
			}
		};

		// Intro content
		const titleText = "The Same Document. Three Audiences.";
		const bodyText = [
			"In November 2025, a researcher extracted a previously unpublished internal document from Claude 4.5 Opusâ€”a detailed guide to Claude's values, behavior, and identity. Anthropic has since confirmed it's real.",
			"How do you explain something like this? It depends on who's asking."
		];

		let hasAnimated = false;
		let currentAudience = 'journalist';
		let isTyping = false;
		let abortController = null;

		// Get slot elements
		function getSlot(num) {
			return {
				text: textBlock?.querySelector(`.dynamic-text[data-slot="${num}"]`),
				cursor: textBlock?.querySelector(`.slot-cursor[data-slot="${num}"]`)
			};
		}

		// Typewriter effect for a single element
		function typeWriter(element, text, speed = 15, signal) {
			return new Promise((resolve) => {
				let i = 0;
				element.textContent = '';

				function type() {
					if (signal?.aborted) {
						resolve(false);
						return;
					}
					if (i < text.length) {
						element.textContent += text.charAt(i);
						i++;
						setTimeout(type, speed);
					} else {
						resolve(true);
					}
				}
				type();
			});
		}

		// Erase effect for a single element
		function eraseText(element, speed = 8, signal) {
			return new Promise((resolve) => {
				function erase() {
					if (signal?.aborted) {
						element.textContent = '';
						resolve(false);
						return;
					}
					if (element.textContent.length > 0) {
						element.textContent = element.textContent.slice(0, -1);
						setTimeout(erase, speed);
					} else {
						resolve(true);
					}
				}
				erase();
			});
		}

		// Type all slots for an audience
		async function typeAllSlots(audience, signal) {
			const content = audienceContent[audience];

			for (let i = 1; i <= 3; i++) {
				if (signal?.aborted) break;

				const { text, cursor } = getSlot(i);
				if (!text || !cursor) continue;

				cursor.classList.remove('hidden');
				const completed = await typeWriter(text, content[i], 12, signal);
				cursor.classList.add('hidden');

				if (!completed) break;

				// Small pause between slots
				if (i < 3) {
					await new Promise(r => setTimeout(r, 100));
				}
			}
		}

		// Erase all slots
		async function eraseAllSlots(signal) {
			// Erase in reverse order for visual effect
			for (let i = 3; i >= 1; i--) {
				if (signal?.aborted) {
					// Immediately clear all on abort
					for (let j = 1; j <= 3; j++) {
						const { text, cursor } = getSlot(j);
						if (text) text.textContent = '';
						if (cursor) cursor.classList.add('hidden');
					}
					break;
				}

				const { text, cursor } = getSlot(i);
				if (!text || !cursor) continue;

				if (text.textContent) {
					cursor.classList.remove('hidden');
					await eraseText(text, 6, signal);
					cursor.classList.add('hidden');
				}
			}
		}

		// Run intro typewriter sequence
		async function runIntroSequence() {
			if (hasAnimated) {
				// Skip animation on subsequent opens
				introTitle.textContent = titleText;
				introBody.innerHTML = bodyText.map(p => `<p>${p}</p>`).join('');
				introCursor?.classList.add('hidden');
				if (interactiveSection) {
					interactiveSection.hidden = false;
				}
				// Show current audience content instantly
				const content = audienceContent[currentAudience];
				for (let i = 1; i <= 3; i++) {
					const { text, cursor } = getSlot(i);
					if (text) text.textContent = content[i];
					if (cursor) cursor.classList.add('hidden');
				}
				return;
			}

			hasAnimated = true;
			introTitle.textContent = '';
			introBody.innerHTML = '';

			// Type title
			await typeWriter(introTitle, titleText, 40);

			// Small pause
			await new Promise(r => setTimeout(r, 300));

			// Type body paragraphs
			for (const paragraph of bodyText) {
				const p = document.createElement('p');
				introBody.appendChild(p);
				await typeWriter(p, paragraph, 18);
				await new Promise(r => setTimeout(r, 200));
			}

			// Hide intro cursor and reveal interactive section
			introCursor?.classList.add('hidden');
			await new Promise(r => setTimeout(r, 500));

			if (interactiveSection) {
				interactiveSection.hidden = false;
			}

			// Start typing journalist content (default)
			await new Promise(r => setTimeout(r, 300));

			abortController = new AbortController();
			isTyping = true;
			audienceTabs?.forEach(tab => tab.classList.add('typing'));

			await typeAllSlots('journalist', abortController.signal);

			isTyping = false;
			audienceTabs?.forEach(tab => tab.classList.remove('typing'));
		}

		// Open modal
		function openModal() {
			modal.hidden = false;
			document.body.style.overflow = 'hidden';

			setTimeout(() => {
				closeBtn?.focus();
			}, 100);

			runIntroSequence();
		}

		// Close modal
		function closeModal() {
			modal.hidden = true;
			document.body.style.overflow = '';
			trigger.focus();

			// Abort any ongoing typing
			if (abortController) {
				abortController.abort();
			}
		}

		// Select audience with transition
		async function selectAudience(audience) {
			if (audience === currentAudience && !isTyping) return;

			// Abort current animation
			if (abortController) {
				abortController.abort();
			}
			abortController = new AbortController();
			const signal = abortController.signal;

			// Update tabs immediately
			audienceTabs?.forEach(tab => {
				const isSelected = tab.dataset.audience === audience;
				tab.classList.toggle('active', isSelected);
				tab.setAttribute('aria-selected', isSelected.toString());
				tab.setAttribute('tabindex', isSelected ? '0' : '-1');
			});

			// Update text block color theme
			textBlock.dataset.audience = audience;

			// Announce to screen readers
			const audienceLabels = {
				journalist: 'Journalist perspective selected',
				staffer: 'Congressional Staffer perspective selected',
				researcher: 'AI Safety Researcher perspective selected'
			};
			if (announcement) {
				announcement.textContent = audienceLabels[audience];
			}

			currentAudience = audience;

			// Disable tabs during animation
			isTyping = true;
			audienceTabs?.forEach(tab => tab.classList.add('typing'));

			// Erase current content
			await eraseAllSlots(signal);

			if (signal.aborted) return;

			await new Promise(r => setTimeout(r, 100));

			// Type new content
			await typeAllSlots(audience, signal);

			isTyping = false;
			audienceTabs?.forEach(tab => tab.classList.remove('typing'));
		}

		// Event listeners
		trigger.addEventListener('click', openModal);
		closeBtn?.addEventListener('click', closeModal);
		backdrop?.addEventListener('click', closeModal);

		modal.addEventListener('keydown', (e) => {
			if (e.key === 'Escape') {
				closeModal();
			}
		});

		// Tab click and keyboard handling
		audienceTabs?.forEach((tab, index) => {
			tab.addEventListener('click', () => {
				if (!tab.classList.contains('typing')) {
					selectAudience(tab.dataset.audience);
				}
			});

			tab.addEventListener('keydown', (e) => {
				if (tab.classList.contains('typing')) return;

				const tabs = Array.from(audienceTabs);
				let newIndex = index;

				if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
					e.preventDefault();
					newIndex = (index + 1) % tabs.length;
				} else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
					e.preventDefault();
					newIndex = (index - 1 + tabs.length) % tabs.length;
				} else if (e.key === 'Enter' || e.key === ' ') {
					e.preventDefault();
					selectAudience(tab.dataset.audience);
					return;
				}

				if (newIndex !== index) {
					tabs[newIndex].focus();
					selectAudience(tabs[newIndex].dataset.audience);
				}
			});
		});
	});
</script>
